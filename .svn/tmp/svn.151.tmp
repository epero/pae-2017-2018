package biz.ucc;

import static org.junit.Assert.assertTrue;
import java.util.List;
import org.junit.Before;
import org.junit.Test;
import biz.contact.ContactDto;
import biz.entreprise.EntrepriseDto;
import biz.factory.BizFactory;
import biz.pdc.PersonneContactDto;
import biz.user.UserDto;
import exceptions.BizException;
import exceptions.FatalException;
import exceptions.OptimisticLockException;
import util.AppContext;
import util.AppContext.DependanceInjection;

public class ContactUccImplTest {
  @DependanceInjection
  private ContactUcc contactUcc;
  @DependanceInjection
  private BizFactory factory;

  private ContactDto contactAVerif;
  private UserDto user;
  private EntrepriseDto entreprise;
  private PersonneContactDto personneContact;
  List<ContactDto> listeContacts;

  // TODO Test concernant la méthode d'incrémentation du nb_contacts

  @Before
  public void setUp() throws Exception {
    AppContext appContext = new AppContext();
    appContext.loadProps("test.properties");
    appContext.recurDepInj(this);
    contactAVerif = factory.getContactVide();
    user = factory.getUserVide();
    entreprise = factory.getEntrepriseVide();
    personneContact = factory.getPersonneContactVide();
  }

  @Test(expected = FatalException.class)
  public void testCreerContactUtilisateur1() {
    contactUcc.creerContactUtilisateur(-1, 0, 2, 1);
  }

  // test user inexistant
  @Test(expected = BizException.class)
  public void testCreerContactUtilisateur2() {
    contactUcc.creerContactUtilisateur(99999, 0, 2, 1);
  }

  // test entreprise inexistant
  @Test(expected = BizException.class)
  public void testCreerContactUtilisateur3() {
    contactUcc.creerContactUtilisateur(1, 0, 9999999, 1);
  }

  // test user admin
  @Test(expected = BizException.class)
  public void testCreerContactUtilisateur4() {
    contactUcc.creerContactUtilisateur(200, 0, 1, 1);
  }

  // test user année aca != année aca courante
  @Test(expected = BizException.class)
  public void testCreerContactUtilisateur5() {
    contactUcc.creerContactUtilisateur(300, 0, 1, 1);
  }

  // test numVersion user diff
  @Test(expected = OptimisticLockException.class)
  public void testCreerContactUtilisateur6() {
    contactUcc.creerContactUtilisateur(100, 99, 2, 2);
  }

  // test avec contact accepte au préalable
  @Test(expected = OptimisticLockException.class)
  public void testCreerContactUtilisateur7() {
    contactUcc.creerContactUtilisateur(100, 99, 2, 2);
  }



  @Test(expected = BizException.class)
  public void testListerContactUtilisateur1() {
    contactUcc.listerContactUtilisateur(99999);
  }

  // @Test(expected = BizException.class)
  // public void testListerContactUtilisateur2() {
  // user.setIdUtilisateur(-1);
  // contactUcc.listerContactUtilisateur(user);
  // }

  @Test
  public void testListerContactUtilisateur3() {
    listeContacts = contactUcc.listerContactUtilisateur(15);
    assertTrue(listeContacts.isEmpty());
  }

  @Test
  public void testListerContactUtilisateur4() {
    listeContacts = contactUcc.listerContactUtilisateur(16);
    assertTrue(!listeContacts.isEmpty());
  }

  // Test pour parcourir l'entiereté de la methode 'listerContactUtilisateur(UserDto)'
  // @Test(expected = CeciNestPasUneException.class)
  @Test(expected = FatalException.class)
  public void testListerContactUtilisateur5() {
    listeContacts = contactUcc.listerContactUtilisateur(17);
  }


}
