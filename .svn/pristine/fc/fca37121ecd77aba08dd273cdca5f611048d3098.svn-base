$(function() {
	
	FrontEnd.onDisplayPage('pageEntreprises', function() {
		remplirEntreprises()

	});

	FrontEnd.onLeavePage('pageEntreprises', function(){
		$('#pagePersonnesContact').css('display','none');
	})
	
	function remplirEntreprises() {
        var dtEntreprises = $('#dtEntreprises').DataTable({
            //retrieve: true,
            destroy: true,
            bAutoWidth : false,
            select: {
                style: 'single'
            },
        	ajax: {
                type: 'POST',
                url: '/',
                dataSrc:"",
                data: {
					'action': 'visualiserEntreprises',
				},
                statusCode: {
                    422: util.err422,
                    401: util.err401,
                    500: util.err500
                }
        	},
            columns : [ 
                         { "data" : "denomination"}, 
                         { "data" : "ville"},
                         //{"data" : "email"},
                         //{ "data" : "tel"},
                         {	"data" : "estBlackListe"}
            ],
            rowId: 'idEntreprise'
        })
        
    	dtEntreprises.on( 'select', function (e, dt) {
            console.log(dt.id());
    		$('#pagePersonnesContact').css('display','block');
    		remplirPersonnesContact(dt.id());

        } )
        .on( 'deselect', function ( e, dt, type, indexes ) {
    		$('#pagePersonnesContact').css('display','none');
        } );
    }
	
	function remplirPersonnesContact(entreprise) {
        var dtPersonnesContact = $('#dtPersonnesContact').DataTable({
            destroy: true,
            bAutoWidth : false,
            select: {
                style: 'single'
            },
        	ajax: {
                type: 'POST',
                url: '/',
                dataSrc:"",
                data: {
					'action': 'visualiserPersonneContact',
					'idEntreprise':entreprise
				},
                statusCode: {
                    422: util.err422,
                    401: util.err401,
                    500: util.err500
                }
        	},
            columns : [ 
                         { "data" : "nom"}, 
                         { "data" : "prenom"},
                         {"data" : "email"},
                         { "data" : "tel"}
            ],
            //rowId: 'idEntreprise'
        })
	}
});