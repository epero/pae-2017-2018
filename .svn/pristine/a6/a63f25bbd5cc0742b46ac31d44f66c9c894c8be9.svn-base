var dtContacts;

FrontEnd.onInitPage('pageDashboardStudent', function() {
	console.log('onInitPage - pageDashBoardStudent');
	
	
	dtContacts = $('#dtContacts').DataTable({
		bAutoWidth : false,
		info : false,
		language : {
			"search" : "Rechercher : ",
			"emptyTable": "Pas de données disponibles dans la table",
			"lengthMenu": "Montrer _MENU_ entrées",
			"paginate": {
				"first":      "Premier",
				"last":       "Dernier",
				"next":       "Suivant",
				"previous":   "Précédent"
			}
		},
		select : {
			style : 'single'
		},
		data : "",
		columns : [ 
			{"data" : "entrepriseDto.denomination"},
			{"data" : "etat"}, 
			{"data" : getPersonneContact},
			{"data" : getEmail},
			{"data" : getTel}
		],
		rowId : 'idContact'
	});

	FrontEnd.onDisplayPage('pageDashboardStudent', function() {
		console.log('onDisplayPage - pageDashBoardStudent');
		$('body').removeClass().toggleClass('theme-teal');
		showNavBar();
		//TODO fix page login : Cannot read property 'nbContacts' of null
		$('#nbContacts').append(myApp.getWhoAmI().nbContacts);
		$('#whoami').text(myApp.getWhoAmI().prenom + " " + myApp.getWhoAmI().nom);
		remplirContacts();
	});

	FrontEnd.onDisplayPage('pageDashboardTeacher', function() {
		console.log('onDisplayPage - pageDashBoardTeacher');
		$('#whoami').text(myApp.getWhoAmI().prenom + " " + myApp.getWhoAmI().nom);
		remplirContacts();
	});
	
});


function remplirContacts() {
	myApp.myajax({
		data : {
			'action' : 'visualiserContacts',
		},
		success : function(data) {
			console.log(data);
			dtContacts.clear();
			dtContacts.rows.add(data).draw();

		}
	});
}

function getPersonneContact(data,type,full){
	if (data.personneContactDto==null){
		return data.entrepriseDto.denomination
	}else{
		return data.personneContactDto.prenom+" "+data.personneContactDto.nom;
	}
}
function getEmail(data,type,full){
	if (data.personneContactDto==null){
		return data.entrepriseDto.email
	}else{
		return data.personneContactDto.email;
	}
}

function getTel(data,type,full){
	if (data.personneContactDto==null){
		return data.entrepriseDto.tel
	}else{
		return data.personneContactDto.tel;
	}
}

function getNbContacts(data,type,full){
	console.log(data.utilisateurDto);
	return data.utilisateurDto.nbContacts;
}

	// ancienne version
	/*
	 * FrontEnd.onDisplayPage('pageDashboardStudent', function(){
	 * $('#whoami').text(whoami.prenom +" " + whoami.nom); console.log('hey');
	 * remplirContacts(); });
	 * 
	 * FrontEnd.onDisplayPage('pageDashboardTeacher', function(){
	 * $('#whoami').text(whoami.prenom +" " + whoami.nom); });
	 * 
	 * function remplirContacts(){ var dtContacts=$('#dtContacts').DataTable({
	 * destroy: true, bAutoWidth : false, select: { style: 'single' }, ajax:{
	 * type:'POST', url:'/', dataSrc:"", data:{ 'action':'visualiserContacts', },
	 * statusCode: { 422: util.err422, 401: util.err401, 500: util.err500 } },
	 * columns: [ {"data" : "entreprise"}, {"data" : "etat"}, {"data" :
	 * "personneContact"}, //{"data" : "email"}, //{"data" : "tel"} ], rowId:
	 * 'idContact' }) }
	 */
