package ihm.services;

import java.io.IOException;
import java.nio.charset.Charset;
import java.util.HashMap;
import java.util.Map;
import java.util.logging.Logger;
import javax.servlet.http.HttpServletResponse;
import com.owlike.genson.Genson;
import util.Util;

public class UtilServiceImpl implements UtilService {

  private String json;
  private Genson genson = new Genson();

  @Override
  public void renvoyerCodeErr(HttpServletResponse resp, Exception ex, int code) throws IOException {

    Logger.getLogger("stagifyLogger")
        .warning("Erreur " + code + "\n\t" + Util.stackTraceToString(ex));
    System.err.println(ex.getMessage());
    ex.printStackTrace();
    json = genson.serialize(ex.getMessage());

    resp.setStatus(code);
    resp.setContentType("application/json");
    resp.getOutputStream().write(json.getBytes(Charset.forName("UTF-8")));
  }

  @Override
  public void renvoyerCodeErrEtMess(HttpServletResponse resp, String messageErreur, int code)
      throws IOException {

    Logger.getLogger("stagifyLogger").warning("Erreur " + code + " - " + messageErreur);
    System.err.println(messageErreur);
    json = genson.serialize(messageErreur);
    resp.setStatus(code);
    resp.setContentType("application/json");
    resp.getOutputStream().write(json.getBytes(Charset.forName("UTF-8")));
  }

  @Override
  public void renvoyerCodeErrEtMessEtObj(HttpServletResponse resp, Exception ex, int code,
      Object object, Genson gens) throws IOException {

    Map<String, Object> infosRetour = new HashMap<String, Object>() {
      {
        put("message", ex.getMessage());
        put("objetDb", object);
      }
    };
    Logger.getLogger("stagifyLogger")
        .warning("Erreur " + code + ", object : " + object + "\n\t" + Util.stackTraceToString(ex));
    String json = gens.serialize(infosRetour);
    ex.printStackTrace();
    resp.setStatus(code);
    resp.setContentType("application/json");
    resp.getOutputStream().write(json.getBytes(Charset.forName("UTF-8")));
  }

}
