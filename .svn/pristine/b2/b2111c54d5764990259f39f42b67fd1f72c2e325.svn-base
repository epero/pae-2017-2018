package biz.ucc;

import java.time.LocalDate;
import java.util.List;
import biz.contact.ContactBiz;
import biz.contact.ContactDto;
import biz.user.UserDto;
import dal.dao.ContactDao;
import dal.services.DalServices;
import util.AppContext.DependanceInjection;
import util.Util;

public class ContactUccImpl implements ContactUcc {
  @DependanceInjection
  private ContactDao contactDao;

  @DependanceInjection
  private DalServices dalServices;

  @Override
  public List<ContactDto> listerContactUtilisateur(UserDto utilisateur) {
    List<ContactDto> contactDtos;

    try {
      dalServices.startTransaction();
      contactDtos = contactDao.listerContactUtilisateur(utilisateur);
    } catch (Exception e) {
      dalServices.rollback();
      throw e;
    } finally {
      dalServices.commitTransaction();
    }
    return contactDtos;
  }

  @Override
  public ContactDto creerContactUtilisateur(ContactDto contact) {

    ContactBiz contactAVerif = (ContactBiz) contact;
    // TODO Check Integer et Object plutôt que juste Object pour les FK
    Util.checkObject(contact.getUtilisateur());
    Util.checkObject(contact.getEntreprise());
    // TODO Si pas de personne de contact, trouver moyen de l'insert en db quand même
    /*
     * if (contact.getPersonneContact() == 0) { contact.setPersonneContact((Integer) null); }
     */
    System.out.println("Personne de contact : " + contact.getPersonneContact());
    contact.setEtat(Util.Etat.INITIE.toString());
    contact.setAnneeAcademique(Util.LocalDateToYear(LocalDate.now()));

    ContactDto contactARenv;
    try {
      dalServices.startTransaction();
      contactARenv = contactDao.insertContactUtilisateur(contactAVerif);
    } catch (Exception ex) {
      dalServices.rollback();
      throw ex;
    } finally {
      dalServices.commitTransaction();
    }
    return contactARenv;
  }

  // @Override
  // public List<ContactDto> listerContactUtilisateur(int idUtilisateur) {
  // return contactDao.listerContactUtilisateur(idUtilisateur);
  // }


}
