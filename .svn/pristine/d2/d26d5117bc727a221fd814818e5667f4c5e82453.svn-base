var dtUtilisateurs;

FrontEnd.onInitPage('pageDashboardTeacher', function() {
	console.log('onInitPage - pageDashBoardTeacher');
	dtUtilisateurs =  $('#dtUtilisateurs').DataTable({
		orderCellsTop: true,
		bAutoWidth : false,
		info : false,
		paging:false,
		dom:"<'pull-left'f>t",
		language : {
			"search" : "Rechercher : ",
			"emptyTable": "Pas de données disponibles dans la table",
			"lengthMenu": "Montrer _MENU_ entrées",
			"paginate": {
				"first":      "Premier",
				"last":       "Dernier",
				"next":       "Suivant",
				"previous":   "Précédent"
			}
		},
		/*select : {
			style : 'single'
		},*/
		data : "",
		columns : [ 
			{"data" : getNomUtilisateur},
			{"data" : getPrenomUtilisateur},
		],
		//rowId : 'idContact'
	});

	
	FrontEnd.onDisplayPage('pageDashboardTeacher', function() {
		console.log('onDisplayPage - pageDashBoardTeacher');
		$('body').removeClass().toggleClass('theme-teal');
		showNavBar();
		//if(myApp.getWhoAmI()!=null)
		//	$('#nbContacts').text('Contacts : ' + myApp.getWhoAmI().nbContacts);
		remplirUtilisateurs();
	    google.charts.load('current', {'packages':['corechart']});
    	google.charts.setOnLoadCallback(drawChartTeacher);
	});
	
	FrontEnd.onLeavePage('pageDashboardTeacher', function() {
		$('#notification').html('');
	});

	function drawChartTeacher() {
		
		var stats;
		
		config = {
			'data': {
				'action': 'fillChartTeacher'
			},
			'success': function (reponse) {
				stats =reponse;
				
				//console.log(stats);
				//console.log(stats.aucuncontact);
		        var data = google.visualization.arrayToDataTable([
		          ['Task', 'Hours per Day'],
		          ['Aucun Contact', stats.aucuncontact],
		          ['Contacts Initiés', stats.contactinities],
		          ['Contact Accepté', stats.contactacceptes],
		          ['Stage en ordre', stats.contactstageenordre]
		        ]);

		        var options = {
		        		chartArea:{width:'100%',height:'70%'},
		        		legend:{position:'bottom'}
		        };

		        var chart = new google.visualization.PieChart(document.getElementById('piechartTeacher'));

		        chart.draw(data, options);
			}
		}
		myApp.myajax(config);
		
    }
});

function remplirUtilisateurs() {
	myApp.myajax({
		data : {
			'action' : 'visualiserUsers',
		},
		success : function(data) {
			console.log(data);
			dtUtilisateurs.clear();
			dtUtilisateurs.rows.add(data).draw();
		}
	});
}

function getNomUtilisateur(data){
	return data.nom;
}

function getPrenomUtilisateur(data){
	return data.prenom;
}