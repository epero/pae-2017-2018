DROP SCHEMA stagify CASCADE;
CREATE SCHEMA stagify;

CREATE TABLE stagify.utilisateurs(
    id_utilisateur      SERIAL PRIMARY KEY,
    pseudo              CHARACTER VARYING(30),
    mdp                 CHARACTER(60),
    nom                 CHARACTER VARYING(50),
    prenom              CHARACTER VARYING(30),
    date_naissance      TIMESTAMP,
    tel                 CHARACTER VARYING(15), 
    email               CHARACTER VARYING(100),
    date_inscription    TIMESTAMP,
    annee_academique    CHARACTER(9),
    est_admin           BOOLEAN,
    nb_contacts         INTEGER
);

CREATE TABLE stagify.entreprises(
    id_entreprise       SERIAL PRIMARY KEY,
    denomination        CHARACTER VARYING(50),
    adresse             CHARACTER VARYING(30),
    numero              INTEGER,
    boite               CHARACTER VARYING(5),
    code_postal         CHARACTER(4),
    ville               CHARACTER VARYING(30),
    email               CHARACTER VARYING(50),
    tel                 CHARACTER VARYING(15),
    est_black_liste     BOOLEAN 
);

CREATE TABLE stagify.personnes_contact(
    id_personne_contact SERIAL PRIMARY KEY,
    nom                 CHARACTER VARYING(50),
    prenom              CHARACTER VARYING(30),
    tel                 CHARACTER VARYING(15),
    email               CHARACTER VARYING(50),
    entreprise         INTEGER  REFERENCES stagify.entreprises(id_entreprise)
);

CREATE TABLE stagify.contacts(
    id_contact          SERIAL PRIMARY KEY,
    utilisateur         INTEGER  REFERENCES stagify.utilisateurs(id_utilisateur),
    entreprise          INTEGER  REFERENCES stagify.entreprises(id_entreprise),
    personne_contact    INTEGER  REFERENCES stagify.personnes_contact(id_personne_contact),
    etat                CHARACTER VARYING(15),
    annee_academique    CHARACTER(9) 
);

CREATE TABLE stagify.stages(
    id_stage            SERIAL PRIMARY KEY,
    annee_academique    CHARACTER(9),
    date_signature      TIMESTAMP,
    adresse             CHARACTER VARYING(30),
    numero              INTEGER,
    boite               CHARACTER VARYING(5),
    code_postal         CHARACTER(4),
    ville               CHARACTER VARYING(30),
    responsable         INTEGER  REFERENCES stagify.personnes_contact(id_personne_contact),
    entreprise          INTEGER  REFERENCES stagify.entreprises(id_entreprise),
    utilisateur         INTEGER  REFERENCES stagify.utilisateurs(id_utilisateur)
);

-- UTILISATEURS
-- bri ; Admin;10.
INSERT INTO "stagify"."utilisateurs" ("id_utilisateur", "pseudo", "mdp", "nom", "prenom", "date_naissance", "tel", "email", "date_inscription", "annee_academique", "est_admin", "nb_contacts") VALUES ('1', 'bri', '$2a$10$MKZg2YfqxLyICMfAoyF3kOSgorfyIVUC7.Typlurmz.QzBLiZMt02', 'Lehmann', 'Brigitte', '1975-01-01 00:00:00', '+32495352104', 'brigitte.lehmann@vinci.be', '2018-02-28 18:00:00', '0000-0000', 't', '0');
-- lau ; Admin;10.
INSERT INTO "stagify"."utilisateurs" ("id_utilisateur", "pseudo", "mdp", "nom", "prenom", "date_naissance", "tel", "email", "date_inscription", "annee_academique", "est_admin", "nb_contacts") VALUES ('2', 'lau', '$2a$10$MKZg2YfqxLyICMfAoyF3kOSgorfyIVUC7.Typlurmz.QzBLiZMt02', 'Leleux', 'Laurent', '1990-01-01 00:00:00', '+32495673210', 'laurent.leleux@vinci.be', '2018-02-28 18:00:05', '0000-0000', 't', '0');
-- don ; Admin;10.
INSERT INTO "stagify"."utilisateurs" ("id_utilisateur", "pseudo", "mdp", "nom", "prenom", "date_naissance", "tel", "email", "date_inscription", "annee_academique", "est_admin", "nb_contacts") VALUES ('3', 'don', '$2a$10$MKZg2YfqxLyICMfAoyF3kOSgorfyIVUC7.Typlurmz.QzBLiZMt02', 'Grolaux', 'Donatien', '1985-01-01 00:00:00', '+32497524731', 'donatien.grolaux@vinci.be', '2018-02-28 18:00:05', '0000-0000', 't', '0');
-- Achille ; mdpuser
INSERT INTO "stagify"."utilisateurs" ("id_utilisateur", "pseudo", "mdp", "nom", "prenom", "date_naissance", "tel", "email", "date_inscription", "annee_academique", "est_admin", "nb_contacts") VALUES ('4', 'Achille', '$2a$10$AvfajQ3KJrIwtaRL893v6eVmNKqCTjpg1wKU8DiwsLnN5wUKW.Iz6', 'Talon', 'Achille', '1995-07-08 00:00:00', '+32498643411', 'achille.talon@student.vinci.be', '2018-03-01 15:45:05', '2017-2018', 'f', '1');
-- Basile ; mdpuser
INSERT INTO "stagify"."utilisateurs" ("id_utilisateur", "pseudo", "mdp", "nom", "prenom", "date_naissance", "tel", "email", "date_inscription", "annee_academique", "est_admin", "nb_contacts") VALUES ('5', 'Basile', '$2a$10$AvfajQ3KJrIwtaRL893v6eVmNKqCTjpg1wKU8DiwsLnN5wUKW.Iz6', 'Lasile', 'Basile', '1998-04-02 00:00:00', '+32471613482', 'basile.lasile@student.vinci.be', '2018-03-01 16:00:00', '2017-2018', 'f', '0');
-- Caroline ; mdpuser
INSERT INTO "stagify"."utilisateurs" ("id_utilisateur", "pseudo", "mdp", "nom", "prenom", "date_naissance", "tel", "email", "date_inscription", "annee_academique", "est_admin", "nb_contacts") VALUES ('6', 'Caroline', '$2a$10$AvfajQ3KJrIwtaRL893v6eVmNKqCTjpg1wKU8DiwsLnN5wUKW.Iz6', 'Smith', 'Caroline', '1999-06-06 00:00:00', '+32495673104', 'caroline.smith@student.vinci.be', '2018-03-01 16:01:01', '2017-2018', 'f', '3');
ALTER SEQUENCE "stagify".utilisateurs_id_utilisateur_seq RESTART WITH 7;

-- ENTREPRISES
INSERT INTO "stagify"."entreprises" ("id_entreprise", "denomination", "adresse", "numero", "boite", "code_postal", "ville", "email", "tel", "est_black_liste") VALUES ('1', 'Xattrapp', 'Avenue de l''Eglise', '666', NULL, '1000', 'Bruxelles', 'contact@xattrapp.b', '+3223549462', 'f');
INSERT INTO "stagify"."entreprises" ("id_entreprise", "denomination", "adresse", "numero", "boite", "code_postal", "ville", "email", "tel", "est_black_liste") VALUES ('2', 'Yggdrasil', 'Avenue de Mai', '103', NULL, '1200', 'Woluwé-Saint-Lambert', 'info@yggdrasil.be', '+322354612', 'f');
INSERT INTO "stagify"."entreprises" ("id_entreprise", "denomination", "adresse", "numero", "boite", "code_postal", "ville", "email", "tel", "est_black_liste") VALUES ('3', 'Zebu', 'Rue Gray', '21', NULL, '1050', 'Ixelles', 'contact@zebu.be', '+3223549565', 'f');
ALTER SEQUENCE "stagify".entreprises_id_entreprise_seq RESTART WITH 4;

-- PERSONNES DE CONTACT
INSERT INTO "stagify"."personnes_contact" ("id_personne_contact", "nom", "prenom", "tel", "email", "entreprise") VALUES ('1', 'Fleur', 'Marguerite', '+32495683101', 'marguerite.fleur@xattrapp.be', '1');
INSERT INTO "stagify"."personnes_contact" ("id_personne_contact", "nom", "prenom", "tel", "email", "entreprise") VALUES ('2', 'Janssens', 'Noémie', '+32497685214', 'noemie.janssens@xattrapp.be', '1');
INSERT INTO "stagify"."personnes_contact" ("id_personne_contact", "nom", "prenom", "tel", "email", "entreprise") VALUES ('3', 'Cia', 'Ortense', '+32498653410', 'ortense_cia@yggdrasil.be', '2');
ALTER SEQUENCE "stagify".personnes_contact_id_personne_contact_seq RESTART WITH 4;

-- CONTACTS
INSERT INTO "stagify"."contacts" ("id_contact", "utilisateur", "entreprise", "personne_contact", "etat", "annee_academique") VALUES ('1', '6', '1', '1', 'initie', '2017-2018');
INSERT INTO "stagify"."contacts" ("id_contact", "utilisateur", "entreprise", "personne_contact", "etat", "annee_academique") VALUES ('2', '6', '2', '3', 'initie', '2017-2018');
INSERT INTO "stagify"."contacts" ("id_contact", "utilisateur", "entreprise", "personne_contact", "etat", "annee_academique") VALUES ('3', '6', '3', NULL, 'initie', '2017-2018');
INSERT INTO "stagify"."contacts" ("id_contact", "utilisateur", "entreprise", "personne_contact", "etat", "annee_academique") VALUES ('4', '4', '2', NULL, 'initie', '2017-2018');
ALTER SEQUENCE "stagify".contacts_id_contact_seq RESTART WITH 5;