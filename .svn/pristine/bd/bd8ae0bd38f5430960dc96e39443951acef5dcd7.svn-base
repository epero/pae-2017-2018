package biz.ucc;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;
import static org.junit.Assert.assertNull;
import java.time.LocalDate;
import org.junit.Before;
import org.junit.Test;
import biz.factory.BizFactory;
import biz.user.UserDto;
import exceptions.BizException;
import util.AppContext;
import util.AppContext.DependanceInjection;

public class UserUccImplTest {
  @DependanceInjection
  private UserUcc userUcc;
  private UserDto userAVerif;
  @DependanceInjection
  private BizFactory factory;

  @Before
  public void setUp() throws Exception {
    // userUcc = new UserUccImpl();
    AppContext appContext = new AppContext();
    appContext.loadProps("test.properties");
    appContext.recurDepInj(this);
    userAVerif = factory.getUserVide();
  }

  // TODO Test concernant la méthode d'incrémentation du nb_contacts

  @Test
  public void testSeConnecter1() {
    userAVerif.setPseudo("blehmann");
    userAVerif.setMdp("azerty");
    UserDto user = userUcc.seConnecter(userAVerif);
    assertNotNull(user);
  }

  @Test(expected = BizException.class)
  public void testSeConnecter2() {
    userAVerif.setPseudo("");
    userAVerif.setMdp("azerty");
    UserDto user = userUcc.seConnecter(userAVerif);
    assertNull(user);
  }

  @Test(expected = BizException.class)
  public void testSeConnecter3() {
    userAVerif.setPseudo("blehmann");
    userAVerif.setMdp("");
    UserDto user = userUcc.seConnecter(userAVerif);
    assertNull(user);
  }

  @Test
  public void testSeConnecter4() {
    UserDto user = userUcc.seConnecter("pierre", "azerty");
    assertNull(user);
  }

  @Test
  public void testSinscire1() {
    userAVerif.setPseudo("blehmann");
    userAVerif.setMdp("azerty");
    userAVerif.setDateNaissance(LocalDate.now().minusYears(30));
    userAVerif.setEmail("brigitte.lehmann@vinci.be");
    userAVerif.setNom("brigitte");
    userAVerif.setPrenom("lehmann");
    userAVerif.setTel("+32495707865");

    UserDto user = userUcc.sinscrire(userAVerif);
    assertNotNull(user);
    assertEquals(user.getPseudo(), userAVerif.getPseudo());

  }

  @Test(expected = BizException.class)
  public void testSinscire2() {
    userAVerif.setPseudo("pierre");
    userAVerif.setMdp("azerty");
    userAVerif.setDateNaissance(LocalDate.now().minusYears(30));
    userAVerif.setEmail("brigitte.lehmann@vinci.be");
    userAVerif.setNom("brigitte");
    userAVerif.setPrenom("lehmann");
    userAVerif.setTel("+32495707865");

    userUcc.sinscrire(userAVerif);

  }

  @Test(expected = BizException.class)
  public void testSinscire3() {
    userAVerif.setPseudo("blehmann");
    userAVerif.setMdp("azerty");
    userAVerif.setDateNaissance(LocalDate.now().minusYears(30));
    userAVerif.setEmail("pierre@vinci.be");
    userAVerif.setNom("brigitte");
    userAVerif.setPrenom("lehmann");
    userAVerif.setTel("+32495707865");

    userUcc.sinscrire(userAVerif);

  }

  @Test(expected = BizException.class)
  public void testSinscire4() {
    userAVerif.setPseudo("");
    userAVerif.setMdp("azerty");
    userAVerif.setDateNaissance(LocalDate.now().minusYears(30));
    userAVerif.setEmail("pierre@vinci.be");
    userAVerif.setNom("brigitte");
    userAVerif.setPrenom("lehmann");
    userAVerif.setTel("+32495707865");

    userUcc.sinscrire(userAVerif);

  }

  @Test(expected = BizException.class)
  public void testSinscire5() {
    userAVerif.setPseudo("blehmann");
    userAVerif.setMdp("azerty");
    userAVerif.setDateNaissance(LocalDate.now().minusYears(30));
    userAVerif.setEmail("blehmann@vinci.be");
    userAVerif.setNom("brigitte");
    userAVerif.setPrenom("lehmann");
    userAVerif.setTel("+32495707865dazehdfeohfze");

    userUcc.sinscrire(userAVerif);

  }

  @Test(expected = BizException.class)
  public void testSinscire6() {
    userAVerif.setPseudo("blehmann");
    userAVerif.setMdp("azerty");
    userAVerif.setDateNaissance(null);
    userAVerif.setEmail("blehmann@vinci.be");
    userAVerif.setNom("brigitte");
    userAVerif.setPrenom("lehmann");
    userAVerif.setTel("+32495707865");

    userUcc.sinscrire(userAVerif);

  }

  @Test(expected = BizException.class)
  public void testSinscire7() {
    userAVerif.setPseudo("blehmann");
    userAVerif.setMdp("azerty");
    userAVerif.setDateNaissance(LocalDate.now().plusYears(30));
    userAVerif.setEmail("blehmann@vinci.be");
    userAVerif.setNom("brigitte");
    userAVerif.setPrenom("lehmann");
    userAVerif.setTel("+32495707865");

    userUcc.sinscrire(userAVerif);

  }
}
