package biz.ucc;

import biz.user.UserBiz;
import biz.user.UserDto;
import biz.user.UserImpl;
import dal.dao.UserDao;
import exceptions.BizException;
import util.AppContext.DependanceInjection;
import util.Util;

class UserUccImpl implements UserUcc {

  @DependanceInjection
  private UserDao userDao;

  @DependanceInjection
  private Util util;

  @Override
  public UserDto seConnecter(String pseudo, String mdp) {

    UserBiz userEnDb = (UserBiz) userDao.getUser(pseudo);


    if (userEnDb != null && userEnDb.verifierMotDePasse(mdp)) {
      return userEnDb;
    }
    return null;
  }

  @Override
  public UserDto seConnecter(UserDto userAverif) {
    // AJOUTER LES CHECKPSEUDO ET CHECKMDP DES QUE GUILLAUME A TERMINE
    UserBiz userEnDb = (UserBiz) userDao.getUser(userAverif.getPseudo());

    if (userEnDb != null && userEnDb.verifierMotDePasse(userAverif.getMdp())) {
      return userEnDb;
    }
    return null;
  }

  @Override
  public UserDto sinscrire(UserDto user) {
    // TODO COMPLETER MESSAGES APPROPRIES
    // PROBLEME: n envoie qu une exception avec 1 message --> quid du cas ou il y a plusieurs champs
    // non-valides?
    UserImpl userI = (UserImpl) user;
    if (!userI.checkFormatPseudo())
      throw new BizException("pseudo");
    if (!userI.checkFormatMdp())
      throw new BizException("mot de passe");
    if (!userI.checkFormatEmail())
      throw new BizException("email");
    if (!userI.checkFormatNom())
      throw new BizException("nom");
    if (!userI.checkFormatPrenom())
      throw new BizException("prenom");
    if (!userI.checkFormatDateNaissance())
      throw new BizException("date de naissance");
    if (!userI.checkFormatTel())
      throw new BizException("telephone");

    // TODO CHECK SI EMAIL ET PSEUDO NE SONT PAS DEJA DANS TABLE UTILISATEURS

    return userDao.insertUser(user);
  }
}
